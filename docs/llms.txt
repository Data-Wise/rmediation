# RMediation

[![CRAN
status](https://www.r-pkg.org/badges/version/RMediation)](https://CRAN.R-project.org/package=RMediation)
[![Website
Status](https://github.com/data-wise/rmediation/actions/workflows/pkgdown.yaml/badge.svg)](https://github.com/data-wise/rmediation/actions/workflows/pkgdown.yaml)
[![Lifecycle:
stable](https://img.shields.io/badge/lifecycle-stable-brightgreen.svg)](https://lifecycle.r-lib.org/articles/stages.html#stable)

**RMediation** provides rigorous statistical methods for mediation
analysis in observational and experimental designs. It addresses the
known limitations of normal-theory confidence intervals (e.g., Sobel
test) by implementing advanced methods that account for the non-normal
distribution of the indirect effect.

## Key Capabilities

### 1. Rigorous Confidence Intervals

Compute accurate Confidence Intervals (CIs) for indirect effects using
methods that outperform the standard normal approximation:

- **Distribution of the Product:** Exact method for the product of two
  normal random variables.
- **Monte Carlo Method:** Robust simulation-based intervals.
- **Bootstrapping:** Parametric and semi-parametric bootstrap
  implementations.

### 2. Advanced Hypothesis Testing

- **LRT-MBCO:** Implements the **Likelihood Ratio Test via Model-Based
  Constrained Optimization**, a powerful frequentist method for testing
  indirect effects that controls Type I error rates better than standard
  approaches.
- **Sobel Test:** Asymptotic normal test included for baseline
  comparison.

### 3. Modern S7 Object-Oriented Design

- **Type-safe classes:** `ProductNormal` and `MBCOResult` S7 classes
  with validators.
- **Meaningful output:** All classes have
  [`print()`](https://data-wise.github.io/rmediation/reference/print.md),
  [`summary()`](https://data-wise.github.io/rmediation/reference/summary.md),
  and
  [`show()`](https://data-wise.github.io/rmediation/reference/show.md)
  methods.
- **Legacy compatible:** Existing code continues to work seamlessly.

### 4. Seamless Integration

- Works directly with summary statistics (coefficients/SEs).
- Extracts parameters automatically from fitted `lavaan` or `OpenMx`
  model objects.
- Auto-detects indirect effects in `lavaan` models (e.g., `ab := a*b`).

------------------------------------------------------------------------

## Installation

### Stable Release (CRAN)

Install the stable version from CRAN:

``` r

install.packages("RMediation")
```

### Development Version (GitHub)

Install the latest development version with new S7 features:

``` r

# Install remotes if needed
install.packages("remotes")

# Install from develop branch
remotes::install_github("Data-Wise/rmediation", ref = "develop")
```

**Development version includes:**

- âœ¨ Modern S7 object-oriented classes (`ProductNormal`, `MBCOResult`)
- ðŸŽ¯ Auto-detection of indirect effects in `lavaan` models  
- ðŸ“Š Enhanced display methods (`print`, `summary`, `show`)
- âœ… Comprehensive input validation with better error messages
- ðŸ”§ All features fully backward compatible

------------------------------------------------------------------------

## Usage

### Using Summary Statistics to Calculate CIs

If you already have estimates from a published paper or other software,
you can calculate CIs using coefficients ($`\hat{a}, \hat{b}`$) and
their standard errors.

``` r

library(RMediation)

# Example: Single mediator
# a = 0.5, b = 0.6, se.a = 0.08, se.b = 0.04, rho = 0 (independence)
medci(mu.x = 0.5, mu.y = 0.6, se.x = 0.08, se.y = 0.04, rho = 0, type = "prodclin")
```

### Using `ci` to Calculate CIs for Indirect Effects of Path with Two Sequential Mediators

``` r

library(RMediation)

# Example: Two sequential mediators
ci(mu = c(b1 = 1, b2 = .7, b3 = .6, b4 = .45),
  Sigma = c(.05, 0, 0, 0, .05, 0, 0, .03, 0, .03),
  quant = ~ b1 * b2 * b3 * b4, type = "MC", plot = TRUE, plotCI = TRUE)
```

### Using S7 `ProductNormal` Class

``` r

library(RMediation)

# Create a ProductNormal distribution
mu <- c(0.5, 0.3)
Sigma <- matrix(c(0.01, 0.002, 0.002, 0.01), 2, 2)
pn <- ProductNormal(mu = mu, Sigma = Sigma)

# Compute confidence interval
ci(pn, level = 0.95)

# Display detailed information
print(pn)
summary(pn)
```

### Using `lavaan` Integration

``` r

library(lavaan)
library(RMediation)

# Define mediation model
model <- '
  m ~ a*x
  y ~ b*m
  ab := a*b
'
fit <- sem(model, data = YourData)

# Auto-detect and compute CI for indirect effect
ci(fit)  # Automatically finds 'ab := a*b'
```

## Contributing

Contributions are welcome! If you encounter issues or have feature
requests:

- [Report a Bug](https://github.com/data-wise/rmediation/issues)

- [Submit a Pull
  Request](https://www.google.com/search?q=https://github.com/data-wise/rmediation/pulls)

## Citation

If you use **RMediation** in your research, please cite the following:

> **Package Reference:** \> Tofighi, D., & MacKinnon, D. P. (2011).
> RMediation: An R package for mediation analysis confidence intervals.
> *Behavior Research Methods*, 43, 692â€“700.
> <doi:10.3758/s13428-011-0076-x>

> **MBCO Method:** \> Tofighi, D., & Kelley, K. (2020). Improved
> inference in mediation analysis: Introducing the model-based
> constrained optimization procedure. *Psychological Methods*, 25(4),
> 496-515. <doi:10.1037/met0000259>

> **Bootstrap MBCO:** \> Tofighi, D. (2020). Bootstrap Model-Based
> Constrained Optimization Tests of Indirect Effects. *Frontiers in
> Psychology*, 10, 2989. <doi:10.3389/fpsyg.2019.02989>

## License

`RMediation` is licensed under the
[GPL-3.0](https://choosealicense.com/licenses/gpl-3.0/).

# Package index

## Core Functions

Main user-facing functions for mediation analysis confidence intervals
and hypothesis testing.

- [`medci()`](https://data-wise.github.io/rmediation/reference/medci.md)
  : Confidence Interval for the Mediated Effect
- [`ci()`](https://data-wise.github.io/rmediation/reference/ci.md) :
  Confidence Interval
- [`mbco()`](https://data-wise.github.io/rmediation/reference/mbco.md) :
  Model-based Constrained Optimization (MBCO) Chi-squared Test

## Distribution Functions

Distribution functions for the product of two normal random variables.

- [`pprodnormal()`](https://data-wise.github.io/rmediation/reference/pprodnormal.md)
  : Percentile for the Distribution of Product of Two Normal Variables
- [`qprodnormal()`](https://data-wise.github.io/rmediation/reference/qprodnormal.md)
  : Quantile for the Distribution of Product of Two Normal Variables
- [`pMC()`](https://data-wise.github.io/rmediation/reference/pMC.md) :
  Probability (percentile) for the Monte Carlo Sampling Distribution of
  a nonlinear function of coefficients estimates
- [`qMC()`](https://data-wise.github.io/rmediation/reference/qMC.md) :
  Quantile for the Monte Carlo Sampling Distribution of a nonlinear
  function of coefficients estimates

## Datasets

Example datasets for demonstrating mediation analysis.

- [`memory_exp`](https://data-wise.github.io/rmediation/reference/memory_exp.md)
  : Memory Experiment Data Description from MacKinnon et al., 2018

## S7 Classes and Generics

Modern S7 object-oriented classes and generic functions for type-safe
mediation analysis.

- [`ProductNormal()`](https://data-wise.github.io/rmediation/reference/ProductNormal.md)
  : ProductNormal Class
- [`MBCOResult()`](https://data-wise.github.io/rmediation/reference/MBCOResult.md)
  : MBCO Result Class
- [`cdf()`](https://data-wise.github.io/rmediation/reference/cdf.md) :
  Cumulative Distribution Function
- [`quantile()`](https://data-wise.github.io/rmediation/reference/quantile.md)
  : Quantile Function
- [`print()`](https://data-wise.github.io/rmediation/reference/print.md)
  : Print method
- [`summary()`](https://data-wise.github.io/rmediation/reference/summary.md)
  : Summary method
- [`show()`](https://data-wise.github.io/rmediation/reference/show.md) :
  Show method

## Utility Functions

S3 methods, validation helpers, and utility functions.

- [`utils_validation`](https://data-wise.github.io/rmediation/reference/utils_validation.md)
  : Enhanced validation and utility functions for ProductNormal class
- [`ProductNormal2()`](https://data-wise.github.io/rmediation/reference/ProductNormal2.md)
  : Enhanced ProductNormal constructor with better validation
- [`ProductNormal_from_lavaan()`](https://data-wise.github.io/rmediation/reference/ProductNormal_from_lavaan.md)
  : Utility function to create ProductNormal from lavaan parameter
  estimates
- [`validate_ProductNormal()`](https://data-wise.github.io/rmediation/reference/validate_ProductNormal.md)
  : Additional validation for ProductNormal objects
- [`is_valid_for_computation()`](https://data-wise.github.io/rmediation/reference/is_valid_for_computation.md)
  : Method to check if ProductNormal object is properly specified for
  computation
- [`tidy(`*`<logLik>`*`)`](https://data-wise.github.io/rmediation/reference/tidy_logLik.md)
  : Creates a data.frame for a log-likelihood object
- [`reexports`](https://data-wise.github.io/rmediation/reference/reexports.md)
  [`tidy`](https://data-wise.github.io/rmediation/reference/reexports.md)
  : Objects exported from other packages

# Articles

### All vignettes

- [Getting Started with
  RMediation](https://data-wise.github.io/rmediation/articles/getting-started.md):
- [Comparing Confidence Interval Methods in
  RMediation](https://data-wise.github.io/rmediation/articles/methods-comparison.md):
